<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Detective: The Campus Theft Mystery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            color: #333;
            position: relative;
        }
        
        .header {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1 i {
            font-size: 2.8rem;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .progress-bar {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            width: 100%;
            position: relative;
        }
        
        .progress {
            height: 100%;
            background-color: #ffeb3b;
            width: 14.28%;
            transition: width 0.5s ease;
        }
        
        .page {
            padding: 30px;
            display: none;
            min-height: 500px;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .note-box {
            background-color: #fff9c4;
            border-left: 6px solid #ff9800;
            padding: 25px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .chinese-note {
            font-size: 2.2rem;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #d32f2f;
            letter-spacing: 2px;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .pinyin {
            font-size: 1.1rem;
            color: #5d4037;
            text-align: center;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .story-text {
            font-size: 1.2rem;
            line-height: 1.7;
            margin-bottom: 25px;
            color: #424242;
        }
        
        .highlight {
            background-color: #e3f2fd;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #1565c0;
        }
        
        .puzzle-section {
            background-color: #f5f5f5;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid #e0e0e0;
        }
        
        .puzzle-title {
            color: #d32f2f;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .puzzle-title i {
            color: #ff9800;
        }
        
        .answer-input {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .answer-input input, .answer-input select {
            padding: 12px 15px;
            border: 2px solid #bdbdbd;
            border-radius: 8px;
            font-size: 1.1rem;
            width: 200px;
            transition: all 0.3s;
        }
        
        .answer-input input:focus, .answer-input select:focus {
            border-color: #d32f2f;
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        .inline-box {
            padding: 8px 12px;
            border: 2px solid #bdbdbd;
            border-radius: 8px;
            font-size: 1.2rem;
            font-family: 'Noto Sans SC', sans-serif;
            width: 120px;
            text-align: center;
            margin: 0 5px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .inline-box:focus {
            border-color: #d32f2f;
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        .btn {
            padding: 12px 25px;
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: #b71c1c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(183, 28, 28, 0.3);
        }
        
        .btn-next {
            background-color: #388e3c;
            margin-top: 20px;
        }
        
        .btn-next:hover {
            background-color: #2e7d32;
            box-shadow: 0 5px 15px rgba(56, 142, 60, 0.3);
        }
        
        .btn-disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }
        
        .btn-disabled:hover {
            background-color: #9e9e9e;
            transform: none;
            box-shadow: none;
        }
        
        .hint {
            background-color: #e8f5e9;
            border: 1px dashed #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .hint-title {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .characters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .character-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            width: 150px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .character-card:hover {
            border-color: #d32f2f;
            transform: translateY(-5px);
        }
        
        .character-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
            border: 3px solid #f5f5f5;
        }
        
        .character-card h4 {
            color: #d32f2f;
            margin-bottom: 5px;
        }
        
        .character-card p {
            font-size: 0.9rem;
            color: #757575;
            line-height: 1.4;
        }
        
        .clue-reveal {
            background-color: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            border-left: 5px solid #7b1fa2;
        }
        
        .clue-reveal h3 {
            color: #7b1fa2;
            margin-bottom: 10px;
        }
        
        .final-answer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(to right, #e8f5e9, #f1f8e9);
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .final-answer h2 {
            color: #388e3c;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .final-note {
            font-size: 2rem;
            color: #d32f2f;
            margin: 20px 0;
            font-weight: bold;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .language-help {
            background-color: #e1f5fe;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #0288d1;
        }
        
        .language-help h4 {
            color: #0288d1;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .language-help p {
            color: #01579b;
        }
        
        .page-counter {
            position: absolute;
            top: 30px;
            right: 30px;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
        }
        
        .correct-answer {
            color: #388e3c;
            font-weight: bold;
        }
        
        .incorrect-answer {
            color: #d32f2f;
            font-weight: bold;
        }
        
        .puzzle-instruction {
            margin: 15px 0;
            color: #555;
            line-height: 1.6;
        }
        
        .culture-notes {
            background-color: #fff3e0;
            border-left: 5px solid #ff9800;
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 10px 10px 0;
        }
        
        .culture-notes h3 {
            color: #ff9800;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .seven-stars-game {
            background-color: #f5f5f5;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #e0e0e0;
        }
        
        .game-container {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            margin: 30px 0;
        }
        
        .day-cards {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .day-card {
            background-color: white;
            border: 2px solid #90caf9;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: move;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .day-card:hover {
            background-color: #e3f2fd;
            transform: translateY(-3px);
        }
        
        .star-slots {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .star-slot {
            background-color: #fff8e1;
            border: 2px dashed #ffb300;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .star-slot.correct {
            background-color: #e8f5e9;
            border-color: #4caf50;
        }
        
        .star-slot.incorrect {
            background-color: #ffebee;
            border-color: #f44336;
        }
        
        .star-icon {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        
        .star-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .game-result {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .game-result.correct {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        
        .drop-zone {
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .drag-over {
            background-color: #f0f0f0;
        }
        
        .final-input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
        }
        
        .puzzle-hint {
            background-color: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 1.1rem;
        }
        
        .puzzle-hint h4 {
            color: #7b1fa2;
            margin-bottom: 10px;
        }
        
        .puzzle-hint ul {
            margin-left: 20px;
        }
        
        .puzzle-hint li {
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .chinese-note {
                font-size: 1.8rem;
            }
            
            .page {
                padding: 20px;
            }
            
            .answer-input {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .answer-input input, .answer-input select {
                width: 100%;
            }
            
            .inline-box {
                width: 100px;
            }
            
            .game-container {
                flex-direction: column;
            }
            
            .final-note {
                font-size: 1.6rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-search"></i> Chinese Detective: Campus Theft Mystery</h1>
            <p>Solve puzzles, learn Chinese, and catch the thief before time runs out!</p>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        
        <div class="page-counter" id="page-counter">Page 1 of 7</div>
        
        <!-- Page 1: Introduction -->
        <div class="page active" id="page1">
            <div class="story-text">
                <p>Welcome, detective! Recently, there's been a string of thefts at your school. Several important final exam materials have gone missing.</p>
                <p>Today you find a crumpled note in your backpack, with an unfinished sentence scrawled on it.</p>
            </div>
            
            <div class="note-box">
                <div class="pinyin">XÄ«ngqÄ« ____ shÃ ngwÇ” ____ diÇn bÃ n, nÇ ____ qÃ¹ ____ hÃ o lÃ³u ____ fÃ¡ngjiÄn zhÇo ____.</div>
                <div class="chinese-note">æ˜ŸæœŸ____ä¸Šåˆ____ç‚¹åŠï¼Œä½ ____å»____å·æ¥¼____æˆ¿é—´æ‰¾____ã€‚</div>
                <div class="pinyin">Translation: On ____day at ____:30 AM, you ____ go to Building ____, Room ____ to find ____.</div>
            </div>
            
            <div class="story-text">
                <p>Just as you're wondering about it, your phone buzzes suddenlyâ€”a text message from an unknown number flashes across the screen:</p>
                
                <div class="clue-reveal">
                    <h3><i class="fas fa-sms"></i> Unknown Message:</h3>
                    <p>"If you can complete the note, you'll find the key clue to stopping the campus theft. Time is running outâ€”the thief could be at the very place mentioned on the note! â€”Someone in the know"</p>
                </div>
                
                <p>You realize this isn't just an ordinary noteâ€”it's a timed puzzle, a race against the clockâ€¦</p>
            </div>
            
            <div class="language-help">
                <h4><i class="fas fa-language"></i> Language Tip</h4>
                <p><span class="highlight">æ˜ŸæœŸ (xÄ«ngqÄ«)</span> means "week" or "day of the week". <span class="highlight">ä¸Šåˆ (shÃ ngwÇ”)</span> means "morning". <span class="highlight">ç‚¹ (diÇn)</span> is used for telling time (like "o'clock"). <span class="highlight">åŠ (bÃ n)</span> means "half".</p>
            </div>
            
            <div class="navigation">
                <div></div>
                <button class="btn btn-next" onclick="nextPage()">Start Investigation <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 2: Day of the week puzzle -->
        <div class="page" id="page2">
            <div class="story-text">
                <p>The note starts off with the day of the week missing, but whoever left it included a riddle to help you figure it out:</p>
            </div>
            
            <div class="note-box">
                <div class="chinese-note">å¦‚æœæ˜¨å¤©æ˜¯æ˜å¤©ï¼Œä»Šå¤©å°±æ˜¯æ˜ŸæœŸäº”ã€‚</div>
                <div class="pinyin">RÃºguÇ’ zuÃ³tiÄn shÃ¬ mÃ­ngtiÄn, jÄ«ntiÄn jiÃ¹ shÃ¬ xÄ«ngqÄ«wÇ”.</div>
                <div class="pinyin">Translation: If yesterday were tomorrow, then today would be Friday.</div>
            </div>
            
            <div class="story-text">
                <p>This is a time cipher set by the thief, who enjoys using such puzzles to mark the dates of his operations. Solve it, and you'll know exactly which day the event is planned for.</p>
            </div>
            
            <div class="puzzle-section">
                <h3 class="puzzle-title"><i class="fas fa-calendar-alt"></i> Puzzle 1: ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ</h3>
                <div class="puzzle-instruction">
                    <p>Based on the riddle: "å¦‚æœæ˜¨å¤©æ˜¯æ˜å¤©ï¼Œä»Šå¤©å°±æ˜¯æ˜ŸæœŸäº”ã€‚If yesterday were tomorrow, then today would be Friday."</p>
                    <p>What day is today actually? Fill in the blank:</p>
                </div>
                
                <div class="chinese-note" style="font-size: 2rem; margin: 20px 0;">
                    ä»Šå¤©<input type="text" id="answerA" class="inline-box" placeholder="" maxlength="3">
                </div>
                
                <div class="answer-input">
                    <button class="btn" onclick="checkAnswerA()">Check Answer <i class="fas fa-check"></i></button>
                    <button class="btn" onclick="showHint('hintA')">Need Hint? <i class="fas fa-lightbulb"></i></button>
                </div>
                
                <div class="hint" id="hintA">
                    <div class="hint-title"><i class="fas fa-lightbulb"></i> Hint</div>
                    <p>Think about it logically: If "yesterday" were "tomorrow", then "today" would be Friday. That means the day that would be "tomorrow" if today were Friday is actually "yesterday". So if today were Friday, "tomorrow" would be Saturday, but that's actually "yesterday". So "today" must be Sunday.</p>
                </div>
                
                <div id="resultA"></div>
            </div>
            
            <!-- Culture Notes Section (hidden until puzzle solved) -->
            <div id="cultureNotesA" style="display: none;">
                <div class="culture-notes">
                    <h3><i class="fas fa-star"></i> Culture Notes: The Seven "Stars" - A Classical Way to Name the Days of the Week</h3>
                    <p>When you learn the days of the week in modern Chinese (æ˜ŸæœŸä¸€, æ˜ŸæœŸäºŒ, æ˜ŸæœŸä¸‰â€¦), you're learning a practical, modern system. But there's a much older and more poetic system hidden within Chinese characters, one that connects language to the stars.</p>
                    <p>It was called the "Seven Luminaries" (ä¸ƒæ›œ, QÄ« YÃ o). Instead of "week," ancient Chinese scholars looked to the sky. They named the seven days after the seven brightest celestial bodies visible to the naked eye: the Sun, the Moon, and the five classical planets.</p>
                    
                    <div class="seven-stars-game">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #d32f2f;">Drag the Modern Days to Their Classical Star Names</h4>
                        
                        <div class="game-container">
                            <div class="day-cards" id="dayCards">
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸä¸€">æ˜ŸæœŸä¸€</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸäºŒ">æ˜ŸæœŸäºŒ</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸä¸‰">æ˜ŸæœŸä¸‰</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸå››">æ˜ŸæœŸå››</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸäº”">æ˜ŸæœŸäº”</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸå…­">æ˜ŸæœŸå…­</div>
                                <div class="day-card" draggable="true" data-day="æ˜ŸæœŸæ—¥">æ˜ŸæœŸæ—¥</div>
                            </div>
                            
                            <div class="star-slots" id="starSlots">
                                <div class="star-slot drop-zone" data-star="æ—¥">
                                    <span class="star-icon">â˜€ï¸</span>
                                    <span class="star-name">æ—¥ (Sun)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="æœˆ">
                                    <span class="star-icon">ğŸŒ™</span>
                                    <span class="star-name">æœˆ (Moon)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="ç«">
                                    <span class="star-icon">ğŸ”¥</span>
                                    <span class="star-name">ç« (Fire/Mars)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="æ°´">
                                    <span class="star-icon">ğŸ’§</span>
                                    <span class="star-name">æ°´ (Water/Mercury)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="æœ¨">
                                    <span class="star-icon">ğŸŒ³</span>
                                    <span class="star-name">æœ¨ (Wood/Jupiter)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="é‡‘">
                                    <span class="star-icon">â­</span>
                                    <span class="star-name">é‡‘ (Metal/Venus)</span>
                                </div>
                                <div class="star-slot drop-zone" data-star="åœŸ">
                                    <span class="star-icon">ğŸª</span>
                                    <span class="star-name">åœŸ (Earth/Saturn)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="answer-input" style="justify-content: center;">
                            <button class="btn" onclick="checkStarGame()">Check Matching <i class="fas fa-check"></i></button>
                            <button class="btn" onclick="resetStarGame()">Reset <i class="fas fa-redo"></i></button>
                        </div>
                        
                        <div class="game-result" id="starGameResult"></div>
                    </div>
                    
                    <p style="margin-top: 15px; font-style: italic;">This classical system is still used in Japan and Korea today for naming days of the week!</p>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn btn-next btn-disabled" id="nextBtnA" onclick="nextPage()">Next Puzzle <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 3: Price calculation puzzle -->
        <div class="page" id="page3">
            <div class="story-text">
                <p>You've discovered the thief's purchase record from the campus supermarket. Calculate the total priceâ€”that'll tell you when the thief is planning to strike.</p>
            </div>
            
            <div class="note-box">
                <div class="chinese-note">è‹¹æœä¸‰å—äº”ä¸€æ–¤ï¼Œé¦™è•‰ä¸¤å—ä¸€æ–¤ã€‚<br>æˆ‘ä¹°ä¸¤æ–¤è‹¹æœï¼Œä¸€æ–¤é¦™è•‰ã€‚</div>
                <div class="pinyin">PÃ­ngguÇ’ sÄn kuÃ i wÇ” yÄ« jÄ«n, xiÄngjiÄo liÇng kuÃ i yÄ« jÄ«n.<br>WÇ’ mÇi liÇng jÄ«n pÃ­ngguÇ’, yÄ« jÄ«n xiÄngjiÄo.</div>
                <div class="pinyin">Translation: Apples 3.5 yuan per jin, bananas 2 yuan per jin.<br>I buy 2 jin of apples, 1 jin of bananas.</div>
            </div>
            
            <div class="puzzle-section">
                <h3 class="puzzle-title"><i class="fas fa-calculator"></i> Puzzle 2: ä¸€å…±å¤šå°‘é’±ï¼Ÿ</h3>
                <div class="puzzle-instruction">
                    <p>Calculate the total price of the purchase (in yuan). The total will be the time (B) in the note.</p>
                </div>
                
                <div class="chinese-note" style="font-size: 2rem; margin: 20px 0;">
                    ä¸€å…±<input type="text" id="answerB" class="inline-box" placeholder="" maxlength="2">å—é’±
                </div>
                
                <div class="answer-input">
                    <button class="btn" onclick="checkAnswerB()">Check Answer <i class="fas fa-check"></i></button>
                    <button class="btn" onclick="showHint('hintB')">Need Hint? <i class="fas fa-lightbulb"></i></button>
                </div>
                
                <div class="hint" id="hintB">
                    <div class="hint-title"><i class="fas fa-lightbulb"></i> Hint</div>
                    <p>Apples: 3.5 yuan/jin Ã— 2 jin = ?</p>
                    <p>Bananas: 2 yuan/jin Ã— 1 jin = ?</p>
                    <p>Total: ? + ? = ?</p>
                </div>
                
                <div id="resultB"></div>
            </div>
            
            <div class="language-help">
                <h4><i class="fas fa-language"></i> Language Tip</h4>
                <p><span class="highlight">è‹¹æœ (pÃ­ngguÇ’)</span> means "apple". <span class="highlight">é¦™è•‰ (xiÄngjiÄo)</span> means "banana". <span class="highlight">å— (kuÃ i)</span> is informal for yuan (Chinese currency). <span class="highlight">ä¸€å…± (yÄ«gÃ²ng)</span> means "in total".</p>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn btn-next btn-disabled" id="nextBtnB" onclick="nextPage()">Next Puzzle <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 4: Suspect puzzle -->
        <div class="page" id="page4">
            <div class="story-text">
                <p>You're faced with five suspects. Each of them has made a statement, but only one of them is telling the truth. Find out who the thief is!</p>
            </div>
            
            <div class="characters">
                <div class="character-card">
                    <div style="background-color: #ffcc80; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ğŸ‘¨â€ğŸ«</div>
                    <h4>è‹±è¯­è€å¸ˆ</h4>
                    <p class="pinyin">YÄ«ngyÇ” lÇoshÄ«</p>
                    <p>English teacher</p>
                    <p><strong>Statement:</strong> æ±‰è¯­è€å¸ˆæ˜¯å°å·ã€‚<br>The Chinese teacher is the thief.</p>
                </div>
                
                <div class="character-card">
                    <div style="background-color: #90caf9; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ğŸ‘©â€ğŸ«</div>
                    <h4>æ±‰è¯­è€å¸ˆ</h4>
                    <p class="pinyin">HÃ nyÇ” lÇoshÄ«</p>
                    <p>Chinese teacher</p>
                    <p><strong>Statement:</strong> è‹±è¯­è€å¸ˆæ˜¯å°å·ã€‚<br>The English teacher is the thief.</p>
                </div>
                
                <div class="character-card">
                    <div style="background-color: #c5e1a5; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ğŸ‘¨â€ğŸ’¼</div>
                    <h4>æœåŠ¡å‘˜</h4>
                    <p class="pinyin">FÃºwÃ¹yuÃ¡n</p>
                    <p>Waiter/Attendant</p>
                    <p><strong>Statement:</strong> åŒ»ç”Ÿä¸æ˜¯å°å·ã€‚<br>The doctor is not the thief.</p>
                </div>
                
                <div class="character-card">
                    <div style="background-color: #ffab91; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ğŸ‘¨â€ğŸ“</div>
                    <h4>å­¦ç”Ÿ</h4>
                    <p class="pinyin">XuÃ©shÄ“ng</p>
                    <p>Student</p>
                    <p><strong>Statement:</strong> åŒ»ç”Ÿæ˜¯å°å·ã€‚<br>The doctor is the thief.</p>
                </div>
                
                <div class="character-card">
                    <div style="background-color: #f8bbd0; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ğŸ‘©â€âš•ï¸</div>
                    <h4>åŒ»ç”Ÿ</h4>
                    <p class="pinyin">YÄ«shÄ“ng</p>
                    <p>Doctor</p>
                    <p><strong>Statement:</strong> æˆ‘ä¸æ˜¯å°å·ã€‚<br>I am not the thief.</p>
                </div>
            </div>
            
            <div class="puzzle-section">
                <h3 class="puzzle-title"><i class="fas fa-user-secret"></i> Puzzle 3: Who is the thief?</h3>
                <div class="puzzle-instruction">
                    <p>Only one person is telling the truth. Who is the thief?</p>
                </div>
                
                <div class="chinese-note" style="font-size: 1.8rem; margin: 20px 0;">
                    è°æ˜¯å°å·ï¼Ÿ
                </div>
                
                <div class="answer-input">
                    <select id="answerF" style="padding: 12px 15px; border: 2px solid #bdbdbd; border-radius: 8px; font-size: 1.1rem; width: 250px;">
                        <option value="">Select the thief</option>
                        <option value="è‹±è¯­è€å¸ˆ">è‹±è¯­è€å¸ˆ (English teacher)</option>
                        <option value="æ±‰è¯­è€å¸ˆ">æ±‰è¯­è€å¸ˆ (Chinese teacher)</option>
                        <option value="æœåŠ¡å‘˜">æœåŠ¡å‘˜ (Waiter)</option>
                        <option value="å­¦ç”Ÿ">å­¦ç”Ÿ (Student)</option>
                        <option value="åŒ»ç”Ÿ">åŒ»ç”Ÿ (Doctor)</option>
                    </select>
                    <button class="btn" onclick="checkAnswerF()">Check Answer <i class="fas fa-check"></i></button>
                    <button class="btn" onclick="showHint('hintF')">Need Hint? <i class="fas fa-lightbulb"></i></button>
                </div>
                
                <div class="hint" id="hintF">
                    <div class="hint-title"><i class="fas fa-lightbulb"></i> Hint</div>
                    <p>Test each possibility: If person X is telling the truth, are all other statements false?</p>
                    <p>Remember: Only ONE person is telling the truth.</p>
                </div>
                
                <div id="resultF"></div>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn btn-next btn-disabled" id="nextBtnF" onclick="nextPage()">Next Puzzle <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 5: Location puzzle -->
        <div class="page" id="page5">
            <div class="story-text">
                <p>Now you need to pinpoint the area where the theft will happen. You have access to the apartment residents' information and their commuting methods.</p>
            </div>
            
            <div class="puzzle-section">
                <h3 class="puzzle-title"><i class="fas fa-map-marker-alt"></i> Puzzle 4: Find the thief's room and transportation</h3>
                
                <div style="display: flex; flex-wrap: wrap; gap: 30px; margin: 20px 0;">
                    <div style="flex: 1; min-width: 300px;">
                        <h4>Commuting Methods:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li>102 æˆ¿é—´çš„äººèµ°è·¯æ¥å­¦æ ¡ä¸Šè‹±è¯­è¯¾ã€‚</li>
                            <li>1102 æˆ¿é—´çš„äººéª‘è‡ªè¡Œè½¦æ¥å­¦æ ¡ç©å„¿ã€‚</li>
                            <li>202 æˆ¿é—´çš„äººéª‘ç”µåŠ¨è½¦æ¥å­¦æ ¡ä¸Šæ±‰è¯­è¯¾ã€‚</li>
                            <li>1202 æˆ¿é—´çš„äººåå…¬å…±æ±½è½¦æ¥å­¦æ ¡åšä½œä¸šã€‚</li>
                        </ul>
                    </div>
                    
                    <div style="flex: 1; min-width: 300px;">
                        <h4>Room Assignments:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li>æœåŠ¡å‘˜ä½ 102 æˆ¿é—´ã€‚</li>
                            <li>åŒ»ç”Ÿä¸ä½ 102 æˆ¿é—´ï¼Œä»–ä½ 1102 æˆ¿é—´ã€‚</li>
                            <li>è€å¸ˆä½ 202 æˆ¿é—´ã€‚</li>
                            <li>å­¦ç”Ÿä¸ä½ 202 æˆ¿é—´ï¼Œæˆ‘ä½ 1202 æˆ¿é—´ã€‚</li>
                        </ul>
                    </div>
                </div>
                
                <div class="puzzle-instruction">
                    <p>Answer the following questions:</p>
                </div>
                
                <div style="margin: 25px 0;">
                    <div style="margin-bottom: 20px;">
                        <p><strong>1. å°å·æ€ä¹ˆå»å­¦æ ¡ï¼Ÿ (How does the thief go to school?)</strong></p>
                        <div class="answer-input">
                            <select id="answerC" style="padding: 12px 15px; border: 2px solid #bdbdbd; border-radius: 8px; font-size: 1.1rem; width: 100%;">
                                <option value="">Select transportation method</option>
                                <option value="èµ°è·¯">èµ°è·¯ (Walk)</option>
                                <option value="éª‘è‡ªè¡Œè½¦">éª‘è‡ªè¡Œè½¦ (Ride a bicycle)</option>
                                <option value="éª‘ç”µåŠ¨è½¦">éª‘ç”µåŠ¨è½¦ (Ride an e-bike)</option>
                                <option value="åå…¬å…±æ±½è½¦">åå…¬å…±æ±½è½¦ (Take the bus)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <p><strong>2. å°å·çš„æˆ¿é—´å·æ˜¯å¤šå°‘ï¼Ÿ (What is the thief's room number?)</strong></p>
                        <div class="chinese-note" style="font-size: 1.8rem; margin: 10px 0;">
                            å°å·ä½<input type="text" id="answerE" class="inline-box" placeholder="" maxlength="4">å·æˆ¿é—´
                        </div>
                    </div>
                </div>
                
                <div class="answer-input">
                    <button class="btn" onclick="checkAnswerCE()">Check Answers <i class="fas fa-check"></i></button>
                    <button class="btn" onclick="showHint('hintCE')">Need Hint? <i class="fas fa-lightbulb"></i></button>
                </div>
                
                <div class="hint" id="hintCE">
                    <div class="hint-title"><i class="fas fa-lightbulb"></i> Hint</div>
                    <p>Look at room assignments: Where does the doctor live?</p>
                    <p>Then check commuting methods: How does that room number person go to school?</p>
                </div>
                
                <div id="resultCE"></div>
            </div>
            
            <div class="language-help">
                <h4><i class="fas fa-language"></i> Language Tip</h4>
                <p>Vocabulary: <span class="highlight">æˆ¿é—´ fÃ¡ngjiÄn</span> (room), <span class="highlight">èµ°è·¯ zÇ’ulÃ¹</span> (walk), <span class="highlight">éª‘è‡ªè¡Œè½¦ qÃ­ zÃ¬xÃ­ngchÄ“</span> (ride bicycle), <span class="highlight">éª‘ç”µåŠ¨è½¦ qÃ­ diÃ ndÃ²ngchÄ“</span> (ride e-bike), <span class="highlight">åå…¬å…±æ±½è½¦ zuÃ² gÅnggÃ²ng qÃ¬chÄ“</span> (take bus), <span class="highlight">æœåŠ¡å‘˜ fÃºwÃ¹yuÃ¡n</span> (waiter), <span class="highlight">åŒ»ç”Ÿ yÄ«shÄ“ng</span> (doctor).</p>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn btn-next btn-disabled" id="nextBtnCE" onclick="nextPage()">Next Puzzle <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 6: Money puzzle -->
        <div class="page" id="page6">
            <div class="language-help">
                <h4><i class="fas fa-language"></i> Language Tip</h4>
                <p><span class="highlight">æ‰¾ (zhÇo)</span> in this context means "to give change". <span class="highlight">é’± (qiÃ¡n)</span> means "money". <span class="highlight">æœ¬ (bÄ›n)</span> is a measure word for books. <span class="highlight">ä¸ª (gÃ¨)</span> is a general measure word. <span class="highlight">æœåŠ¡å‘˜ fÃºwÃ¹yuÃ¡n</span> (waiter).</p>
            </div>
            
            <div class="story-text">
                <p>A bookstore receipt was found in the thief's room, but the price was altered. Using the purchase details, work backward to figure out how much money the thief had. That amount is likely the building number the thief lives in.</p>
            </div>
            
            <div class="note-box">
                <div class="chinese-note">ä»–ä¹°ä¸€æœ¬æ±‰è¯­ä¹¦ï¼ŒæœåŠ¡å‘˜æ‰¾ä»– 5 å—é’±ã€‚<br>ä»–ä¹°ä¸€ä¸ªæœ¬å­ï¼ŒæœåŠ¡å‘˜æ‰¾ä»– 8 å—é’±ã€‚<br>ä»–ä¹°ä¸€æœ¬æ±‰è¯­ä¹¦å’Œä¸€ä¸ªæœ¬å­ï¼ŒæœåŠ¡å‘˜æ‰¾ä»– 3 å—é’±ã€‚</div>
                <div class="pinyin">TÄ mÇi yÄ« bÄ›n HÃ nyÇ” shÅ«, fÃºwÃ¹yuÃ¡n zhÇo tÄ 5 kuÃ i qiÃ¡n.<br>TÄ mÇi yÄ« gÃ¨ bÄ›nzi, fÃºwÃ¹yuÃ¡n zhÇo tÄ 8 kuÃ i qiÃ¡n.<br>TÄ mÇi yÄ« bÄ›n HÃ nyÇ” shÅ« hÃ© yÄ« gÃ¨ bÄ›nzi, fÃºwÃ¹yuÃ¡n zhÇo tÄ 3 kuÃ i qiÃ¡n.</div>
                <div class="pinyin">Translation: He buys a Chinese book, the waiter gives him 5 yuan change.<br>He buys a notebook, the waiter gives him 8 yuan change.<br>He buys a Chinese book and a notebook, the waiter gives him 3 yuan change.</div>
            </div>
            
            <div class="puzzle-section">
                <h3 class="puzzle-title"><i class="fas fa-money-bill-wave"></i> Puzzle 5: å°å·æœ‰å¤šå°‘é’±ï¼Ÿ</h3>
                <div class="puzzle-instruction">
                    <p>Assuming the thief pays the same amount each time (he always uses the same bill/money amount), calculate how much money (D) he had.</p>
                </div>
                
                <div class="chinese-note" style="font-size: 1.8rem; margin: 20px 0;">
                    å°å·æœ‰<input type="text" id="answerD" class="inline-box" placeholder="" maxlength="2">å—é’±
                </div>
                
                <div class="answer-input">
                    <button class="btn" onclick="checkAnswerD()">Check Answer <i class="fas fa-check"></i></button>
                    <button class="btn" onclick="showHint('hintD')">Need Hint? <i class="fas fa-lightbulb"></i></button>
                </div>
                
                <div class="hint" id="hintD">
                    <div class="hint-title"><i class="fas fa-lightbulb"></i> Hint</div>
                    <p>Let X = price of Chinese book, Y = price of notebook, M = amount of money thief has.</p>
                    <p>From statement 1: M - X = 5</p>
                    <p>From statement 2: M - Y = 8</p>
                    <p>From statement 3: M - (X + Y) = 3</p>
                    <p>Try substituting and solving for M.</p>
                </div>
                
                <div id="resultD"></div>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn btn-next btn-disabled" id="nextBtnD" onclick="nextPage()">Solve Mystery <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- Page 7: Final solution -->
        <div class="page" id="page7">
            <div class="story-text">
                <h2>Complete the Note!</h2>
                <p>Now fill in all the blanks in the note based on the puzzles you've solved:</p>
            </div>
            
            <div class="final-answer">
                <h2><i class="fas fa-check-circle"></i> The Complete Note</h2>
                
                <div class="puzzle-hint">
                    <h4>Remember your answers from each puzzle:</h4>
                    <ul>
                        <li>A: ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ</li>
                        <li>B: ä¸€å…±å¤šå°‘é’±ï¼Ÿ</li>
                        <li>C: å°å·æ€ä¹ˆæ¥å­¦æ ¡ï¼Ÿ</li>
                        <li>D: å°å·æœ‰å¤šå°‘é’±ï¼Ÿ</li>
                        <li>E: å°å·çš„æˆ¿é—´å·æ˜¯å¤šå°‘ï¼Ÿ</li>
                        <li>F: å°å·æ˜¯è°ï¼Ÿ</li>
                    </ul>
                </div>
                
                <div class="final-note">
                    <div style="font-size: 2rem; margin: 20px 0;">
                        æ˜ŸæœŸ<input type="text" id="finalA" class="inline-box" placeholder="" maxlength="2">
                        ä¸Šåˆ<input type="text" id="finalB" class="inline-box" placeholder="" maxlength="2">
                        ç‚¹åŠï¼Œä½ <input type="text" id="finalC" class="inline-box" style="width: 150px;" placeholder="" maxlength="10">
                        å»<input type="text" id="finalD" class="inline-box" placeholder="" maxlength="2">
                        å·æ¥¼<input type="text" id="finalE" class="inline-box" style="width: 100px;" placeholder="" maxlength="4">
                        æˆ¿é—´æ‰¾<input type="text" id="finalF" class="inline-box" style="width: 100px;" placeholder="" maxlength="4">ã€‚
                    </div>
                </div>
                
                <div style="margin: 30px 0;">
                    <div class="answer-input" style="justify-content: center;">
                        <button class="btn" onclick="checkFinalAnswer()">Submit Final Answer <i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
                
                <div id="finalResult" style="min-height: 100px;"></div>
                
                <div id="congratulations" style="display: none;">
                    <h3 style="color: #388e3c; margin: 20px 0;">ğŸ‰ Congratulations Detective! ğŸ‰</h3>
                    <p style="font-size: 1.2rem; margin-bottom: 20px;">You've successfully solved the mystery and completed the note!</p>
                    
                    <div class="clue-reveal">
                        <h3><i class="fas fa-trophy"></i> Case Solved!</h3>
                        <p>You've successfully deciphered the thief's note! Now you know where and when the thief will strike!</p>
                        
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="showTranslation()" style="background-color: #1976d2;">Show English Translation <i class="fas fa-language"></i></button>
                        </div>
                    </div>
                    
                    <div id="translation" style="display: none; margin-top: 25px; padding: 20px; background-color: #e8f5e9; border-radius: 10px;">
                        <h3 style="color: #388e3c; margin-bottom: 10px;">English Translation:</h3>
                        <p style="font-size: 1.3rem; color: #2e7d32;">On Sunday at 9:30 AM, you ride a bicycle to Building 10, Room 1102 to find the doctor.</p>
                        <p style="margin-top: 15px; font-style: italic;">Now you know where and when the thief will strike! Hurry to stop the campus theft!</p>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn" onclick="restartGame()">Play Again <i class="fas fa-redo"></i></button>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const totalPages = 7;
        const answers = {
            A: null,
            B: null,
            C: null,
            D: null,
            E: null,
            F: null
        };
        
        // Star game matching
        const starMatching = {
            "æ˜ŸæœŸæ—¥": "æ—¥",
            "æ˜ŸæœŸä¸€": "æœˆ",
            "æ˜ŸæœŸäºŒ": "ç«",
            "æ˜ŸæœŸä¸‰": "æ°´",
            "æ˜ŸæœŸå››": "æœ¨",
            "æ˜ŸæœŸäº”": "é‡‘",
            "æ˜ŸæœŸå…­": "åœŸ"
        };
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updatePageCounter();
            initializeStarGame();
        });
        
        function nextPage() {
            if (currentPage < totalPages) {
                document.getElementById(`page${currentPage}`).classList.remove('active');
                currentPage++;
                document.getElementById(`page${currentPage}`).classList.add('active');
                updateProgress();
                updatePageCounter();
            }
        }
        
        function prevPage() {
            if (currentPage > 1) {
                document.getElementById(`page${currentPage}`).classList.remove('active');
                currentPage--;
                document.getElementById(`page${currentPage}`).classList.add('active');
                updateProgress();
                updatePageCounter();
            }
        }
        
        function updateProgress() {
            const progressPercent = (currentPage / totalPages) * 100;
            document.getElementById('progress').style.width = `${progressPercent}%`;
        }
        
        function updatePageCounter() {
            document.getElementById('page-counter').textContent = `Page ${currentPage} of ${totalPages}`;
        }
        
        function showHint(hintId) {
            const hint = document.getElementById(hintId);
            hint.style.display = 'block';
        }
        
        // Puzzle 1: Day of the week
        function checkAnswerA() {
            const answerInput = document.getElementById('answerA').value.trim();
            const resultDiv = document.getElementById('resultA');
            const nextBtn = document.getElementById('nextBtnA');
            const cultureNotes = document.getElementById('cultureNotesA');
            
            // Accept multiple correct answers
            const correctAnswers = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸå¤©', 'æ˜ŸæœŸä¸ƒ'];
            
            if (correctAnswers.includes(answerInput)) {
                const displayAnswer = answerInput === 'æ˜ŸæœŸä¸ƒ' ? 'æ˜ŸæœŸæ—¥' : answerInput;
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Correct! ä»Šå¤©${displayAnswer} means "Today is Sunday". The thief is planning the theft for ${displayAnswer}.</p>`;
                answers.A = displayAnswer;
                nextBtn.classList.remove('btn-disabled');
                cultureNotes.style.display = 'block';
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Not quite. Remember: If yesterday were tomorrow, today would be Friday. What day would make that true?</p>`;
                nextBtn.classList.add('btn-disabled');
                cultureNotes.style.display = 'none';
            }
        }
        
        // Puzzle 2: Price calculation
        function checkAnswerB() {
            const answerInput = document.getElementById('answerB').value.trim();
            const resultDiv = document.getElementById('resultB');
            const nextBtn = document.getElementById('nextBtnB');
            
            // Accept both "9" and "ä¹"
            const correctAnswers = ['9', 'ä¹'];
            
            if (correctAnswers.includes(answerInput)) {
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Correct! 2æ–¤è‹¹æœ (7å…ƒ) + 1æ–¤é¦™è•‰ (2å…ƒ) = 9å…ƒ. So the time is 9:30 AM (ä¸Šåˆä¹ç‚¹åŠ).</p>`;
                answers.B = 9;
                nextBtn.classList.remove('btn-disabled');
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Incorrect. Calculate: Apples are 3.5å…ƒ per æ–¤, and the thief bought 2æ–¤. Bananas are 2å…ƒ per æ–¤, and the thief bought 1æ–¤.</p>`;
                nextBtn.classList.add('btn-disabled');
            }
        }
        
        // Puzzle 3: Who is the thief
        function checkAnswerF() {
            const answerInput = document.getElementById('answerF').value;
            const resultDiv = document.getElementById('resultF');
            const nextBtn = document.getElementById('nextBtnF');
            
            if (answerInput === 'åŒ»ç”Ÿ') {
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Correct! åŒ»ç”Ÿ (yÄ«shÄ“ng, doctor) is the thief. Only the student was telling the truth.</p>`;
                answers.F = answerInput;
                nextBtn.classList.remove('btn-disabled');
            } else if (answerInput) {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Incorrect. Remember: Only one person is telling the truth. Try testing each possibility.</p>`;
                nextBtn.classList.add('btn-disabled');
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer">Please select an answer.</p>`;
                nextBtn.classList.add('btn-disabled');
            }
        }
        
        // Puzzle 4: Transportation and room number
        function checkAnswerCE() {
            const answerC = document.getElementById('answerC').value;
            const answerE = document.getElementById('answerE').value.trim();
            const resultDiv = document.getElementById('resultCE');
            const nextBtn = document.getElementById('nextBtnCE');
            
            let correctC = false;
            let correctE = false;
            
            if (answerC === 'éª‘è‡ªè¡Œè½¦') {
                correctC = true;
            }
            
            if (answerE === '1102') {
                correctE = true;
            }
            
            if (correctC && correctE) {
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Correct! The doctor (thief) lives in room 1102 and rides a bicycle to school.</p>`;
                answers.C = answerC;
                answers.E = answerE;
                nextBtn.classList.remove('btn-disabled');
            } else if (!correctC && !correctE) {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Both answers are incorrect. Check room assignments and commuting methods again.</p>`;
                nextBtn.classList.add('btn-disabled');
            } else if (!correctC) {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Room number is correct, but transportation is wrong. Check how the person in room 1102 goes to school.</p>`;
                nextBtn.classList.add('btn-disabled');
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Transportation is correct, but room number is wrong. Check where the doctor lives.</p>`;
                nextBtn.classList.add('btn-disabled');
            }
        }
        
        // Puzzle 5: Money puzzle
        function checkAnswerD() {
            const answerInput = document.getElementById('answerD').value.trim();
            const resultDiv = document.getElementById('resultD');
            const nextBtn = document.getElementById('nextBtnD');
            
            // Accept both "10" and "å"
            const correctAnswers = ['10', 'å'];
            
            if (correctAnswers.includes(answerInput)) {
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Correct! The thief had 10 yuan, so the building number is 10å·æ¥¼.</p>`;
                answers.D = 10;
                nextBtn.classList.remove('btn-disabled');
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Incorrect. Set up equations: Let M = money thief has, X = book price, Y = notebook price. M - X = 5, M - Y = 8, M - (X+Y) = 3. Solve for M.</p>`;
                nextBtn.classList.add('btn-disabled');
            }
        }
        
        // Star game functions
        function initializeStarGame() {
            const dayCards = document.querySelectorAll('.day-card');
            const starSlots = document.querySelectorAll('.star-slot');
            
            dayCards.forEach(card => {
                card.addEventListener('dragstart', dragStart);
            });
            
            starSlots.forEach(slot => {
                slot.addEventListener('dragover', dragOver);
                slot.addEventListener('dragleave', dragLeave);
                slot.addEventListener('drop', drop);
            });
        }
        
        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.day);
            e.target.classList.add('dragging');
        }
        
        function dragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }
        
        function dragLeave(e) {
            e.target.classList.remove('drag-over');
        }
        
        function drop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const day = e.dataTransfer.getData('text/plain');
            const starSlot = e.target.closest('.star-slot');
            const expectedStar = starSlot.dataset.star;
            
            // Remove any existing day from this slot
            const existingDay = starSlot.querySelector('.day-card');
            if (existingDay) {
                document.getElementById('dayCards').appendChild(existingDay);
            }
            
            // Find the dragged card and move it to the slot
            const draggedCard = document.querySelector(`.day-card[data-day="${day}"]`);
            starSlot.innerHTML = `
                <span class="star-icon">${starSlot.querySelector('.star-icon').textContent}</span>
                <span class="star-name">${starSlot.querySelector('.star-name').textContent}</span>
            `;
            starSlot.appendChild(draggedCard);
            
            // Remove dragging class
            draggedCard.classList.remove('dragging');
        }
        
        function checkStarGame() {
            const starSlots = document.querySelectorAll('.star-slot');
            let allCorrect = true;
            const resultDiv = document.getElementById('starGameResult');
            
            starSlots.forEach(slot => {
                const dayCard = slot.querySelector('.day-card');
                const expectedStar = slot.dataset.star;
                
                if (dayCard) {
                    const day = dayCard.dataset.day;
                    const correctStar = starMatching[day];
                    
                    if (correctStar === expectedStar) {
                        slot.classList.add('correct');
                        slot.classList.remove('incorrect');
                    } else {
                        slot.classList.add('incorrect');
                        slot.classList.remove('correct');
                        allCorrect = false;
                    }
                } else {
                    slot.classList.add('incorrect');
                    slot.classList.remove('correct');
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                resultDiv.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Perfect! You've matched all the modern days with their classical star names! The classical system is still used in Japan and Korea today.</p>`;
                resultDiv.className = 'game-result correct';
            } else {
                resultDiv.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Not quite right. Remember: æ˜ŸæœŸæ—¥ = æ—¥ (Sun), æ˜ŸæœŸä¸€ = æœˆ (Moon), æ˜ŸæœŸäºŒ = ç« (Fire/Mars), æ˜ŸæœŸä¸‰ = æ°´ (Water/Mercury), æ˜ŸæœŸå›› = æœ¨ (Wood/Jupiter), æ˜ŸæœŸäº” = é‡‘ (Metal/Venus), æ˜ŸæœŸå…­ = åœŸ (Earth/Saturn).</p>`;
                resultDiv.className = 'game-result incorrect';
            }
            
            resultDiv.style.display = 'block';
        }
        
        function resetStarGame() {
            const starSlots = document.querySelectorAll('.star-slot');
            const dayCardsContainer = document.getElementById('dayCards');
            const resultDiv = document.getElementById('starGameResult');
            
            // Move all day cards back to the container
            starSlots.forEach(slot => {
                const dayCard = slot.querySelector('.day-card');
                if (dayCard) {
                    dayCardsContainer.appendChild(dayCard);
                }
                
                // Reset slot content
                const starIcon = slot.querySelector('.star-icon').textContent;
                const starName = slot.querySelector('.star-name').textContent;
                slot.innerHTML = `
                    <span class="star-icon">${starIcon}</span>
                    <span class="star-name">${starName}</span>
                `;
                slot.classList.remove('correct', 'incorrect', 'drag-over');
            });
            
            // Reset result display
            resultDiv.style.display = 'none';
            resultDiv.innerHTML = '';
        }
        
        // Final page: Check all answers
        function checkFinalAnswer() {
            const finalA = document.getElementById('finalA').value.trim();
            const finalB = document.getElementById('finalB').value.trim();
            const finalC = document.getElementById('finalC').value.trim();
            const finalD = document.getElementById('finalD').value.trim();
            const finalE = document.getElementById('finalE').value.trim();
            const finalF = document.getElementById('finalF').value.trim();
            
            const finalResult = document.getElementById('finalResult');
            const congratsDiv = document.getElementById('congratulations');
            
            // Check each answer
            let allCorrect = true;
            let errorMessage = "";
            
            // Check A (day) - accept æ—¥ or å¤©
            if (finalA !== "æ—¥" && finalA !== "å¤©") {
                allCorrect = false;
                errorMessage += "First blank should be æ—¥ or å¤© (for æ˜ŸæœŸæ—¥/æ˜ŸæœŸå¤©).<br>";
            }
            
            // Check B (time) - accept 9 or ä¹
            if (finalB !== "9" && finalB !== "ä¹") {
                allCorrect = false;
                errorMessage += "Second blank should be 9 or ä¹ (for 9:30).<br>";
            }
            
            // Check C (transportation)
            if (finalC !== "éª‘è‡ªè¡Œè½¦") {
                allCorrect = false;
                errorMessage += "Third blank should be éª‘è‡ªè¡Œè½¦ (ride bicycle).<br>";
            }
            
            // Check D (building) - accept 10 or å
            if (finalD !== "10" && finalD !== "å") {
                allCorrect = false;
                errorMessage += "Fourth blank should be 10 or å (for Building 10).<br>";
            }
            
            // Check E (room)
            if (finalE !== "1102") {
                allCorrect = false;
                errorMessage += "Fifth blank should be 1102 (room number).<br>";
            }
            
            // Check F (person)
            if (finalF !== "åŒ»ç”Ÿ") {
                allCorrect = false;
                errorMessage += "Sixth blank should be åŒ»ç”Ÿ (doctor).<br>";
            }
            
            if (allCorrect) {
                finalResult.innerHTML = `<p class="correct-answer"><i class="fas fa-check-circle"></i> Perfect! You've completed the note:</p>`;
                const dayDisplay = finalA === "æ—¥" ? "æ˜ŸæœŸæ—¥" : "æ˜ŸæœŸå¤©";
                const timeDisplay = finalB === "ä¹" ? "ä¹" : "9";
                finalResult.innerHTML += `<div class="chinese-note" style="font-size: 1.8rem; margin: 15px 0;">${dayDisplay}ä¸Šåˆ${timeDisplay}ç‚¹åŠï¼Œä½ éª‘è‡ªè¡Œè½¦å»${finalD === "å" ? "å" : "10"}å·æ¥¼1102æˆ¿é—´æ‰¾åŒ»ç”Ÿã€‚</div>`;
                
                // Show congratulations
                congratsDiv.style.display = 'block';
            } else {
                finalResult.innerHTML = `<p class="incorrect-answer"><i class="fas fa-times-circle"></i> Some answers are incorrect:</p><p>${errorMessage}</p>`;
                congratsDiv.style.display = 'none';
            }
        }
        
        function showTranslation() {
            document.getElementById('translation').style.display = 'block';
        }
        
        function restartGame() {
            // Reset all answers
            for (let key in answers) {
                answers[key] = null;
            }
            
            // Reset all inputs
            const inputIds = ['answerA', 'answerB', 'answerF', 'answerC', 'answerE', 'answerD', 
                             'finalA', 'finalB', 'finalC', 'finalD', 'finalE', 'finalF'];
            inputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            
            // Reset select inputs
            document.getElementById('answerF').value = '';
            document.getElementById('answerC').value = '';
            
            // Reset all result displays
            const resultDivs = ['resultA', 'resultB', 'resultF', 'resultCE', 'resultD', 'finalResult'];
            resultDivs.forEach(id => {
                if (document.getElementById(id)) {
                    document.getElementById(id).innerHTML = '';
                }
            });
            
            // Reset all next buttons
            const nextBtns = ['nextBtnA', 'nextBtnB', 'nextBtnF', 'nextBtnCE', 'nextBtnD'];
            nextBtns.forEach(id => {
                document.getElementById(id).classList.add('btn-disabled');
            });
            
            // Hide all hints
            const hints = ['hintA', 'hintB', 'hintF', 'hintCE', 'hintD'];
            hints.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            // Hide culture notes
            const cultureNotes = document.getElementById('cultureNotesA');
            if (cultureNotes) cultureNotes.style.display = 'none';
            
            // Reset star game
            resetStarGame();
            
            // Reset final page elements
            const congratsDiv = document.getElementById('congratulations');
            if (congratsDiv) congratsDiv.style.display = 'none';
            
            const translationDiv = document.getElementById('translation');
            if (translationDiv) translationDiv.style.display = 'none';
            
            // Go back to page 1
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage = 1;
            document.getElementById(`page${currentPage}`).classList.add('active');
            updateProgress();
            updatePageCounter();
        }
    </script>
</body>
</html>
